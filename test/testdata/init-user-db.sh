#!/bin/bash
set -e

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" <<-EOSQL
    -- connect to the target DB created via Testcontainers
    \connect usermanagementdb;

    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

    CREATE TABLE IF NOT EXISTS USERS (
      USER_ID UUID PRIMARY KEY,
      FIRST_NAME VARCHAR(100) NOT NULL,
      LAST_NAME VARCHAR(100) NOT NULL,
      EMAIL TEXT UNIQUE NOT NULL,  
      PHONE TEXT NOT NULL,  
      AGE SMALLINT NOT NULL,
      STATUS TEXT NOT NULL
    );

    CREATE TABLE IF NOT EXISTS INSTRUMENTS (
        ID UUID PRIMARY KEY,
        SYMBOL VARCHAR(20) NOT NULL UNIQUE,
        NAME VARCHAR(100) NOT NULL,
        INSTRUMENT_TYPE VARCHAR(20) NOT NULL,
        EXCHANGE VARCHAR(20) NOT NULL,
        LAST_PRICE NUMERIC(18, 6) DEFAULT 0 NOT NULL,
        CREATED_AT TIMESTAMP DEFAULT NOW() NOT NULL,
        UPDATED_AT TIMESTAMP DEFAULT NOW() NOT NULL
    );
EOSQL